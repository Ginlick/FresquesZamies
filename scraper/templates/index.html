<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <title>Fresques Zamies & Co</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Hanken+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --accentcolor-1: #7ea656;
            --accentcolor-2: #820001;
            --accentcolor-1-light: #cedebf;
            --accentcolor-2-light: #e4c5c5;
            --fontfam-headings: "Hanken Grotesk", Arial, sans-serif;
            --fontfam-text: "Montserrat", Arial, sans-serif;
        }

        .cornerimg {
            position: fixed;
            top: 0;
            right: 0;
            width: min(45px, 20%);
            z-index: -1;
        }

        h1, h2 {
            font-family: var(--fontfam-headings);
        }

        h1 {
            font-size: 40px;
        }

        h2 {
            font-size: 30px;
        }

        p {
            font-family: var(--fontfam-headings);
            color: #323331;
            font-size: 18px;
        }

        a {
            color: var(--accentcolor-2);
            transition: .2s ease;
        }

            a:hover {
                color: #53cb8f;
            }

        #.titleCont {
            #margin: 250px 0 100px;
            #
        }

        .titleCont h1 {
            background-image: url('images/cotton.png');
            font-size: 40px;
        }

        .slogan {
            font-size: 22px;
        }

        .cont-column {
            width: min(100%, 1000px);
            margin: auto;
        }

        .tableCont {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .eventsTable {
            border-collapse: collapse;
            width: 100%;
            background-image: url('images/cotton.png');
        }

        .eventsTable thead {
            background-image: url('images/brownpaper.png');
            font-weight: bold;
        }

        .eventsTable th {
            padding: 8px;
            font-family: var(--fontfam-text);
            text-align: left;
        }

        .eventsTable td {
            padding: 8px;
            font-family: var(--fontfam-text);
        }

        .eventsTable tr {
            transition: .3s ease;
        }

        .eventsTable tr:nth-child(even) {
            background-color: #d5e8f0;
        }

        .hidden {
            visibility: hidden;
        }
        .removed {
            display: none;
        }

        .eventsTable tbody tr:hover {
            background-color: #53cb8f;
            cursor: pointer;
        }

        .eventsTable tr:hover span {
            visibility: visible;
        }

        .impactCont {
            width: 20%;
            margin: 50px auto;
            text-align: center;
        }

        .impactCont img {
            width: 100%;
        }

        .LanguageFlag {
            padding: 2px 10px;
        }

        .Highlighted {
            background-image: url('images/brownpaper.png');
        }

        @media screen and (max-width: 1000px) {
            span.EventLocationDetails {
                display: none;
            }
        }
        @media screen and (max-width: 700px) {
            th.EventLongDate, td.EventLongDate {
                display: none;
            }
            th.EventShortDate, td.EventShortDate {
                display: table-cell;
            }
        }
    </style>

    <script>
        const languageStrings = {{languageStrings}}
        function changeLanguage(lang, locale, region_set) {
            for (let i in languageStrings) {
                let d = languageStrings.at(i)
                document.getElementById(d.id).innerHTML = d[lang]
            }
            rebuildEventTable(region_set, locale)
            const collection = document.getElementsByClassName("LanguageFlag");
            for (let i = 0; i < collection.length; i++) {
                e = collection[i];
                if (e.id == "Flag-" + lang) {
                    e.classList.add("Highlighted");
                } else {
                    e.classList.remove("Highlighted");
                }
            }
        }
        events = {{ eventsAsJSON }}
        function updateDateDiff() {
            // NOTE: this code ignores time zones.
            let inputInitialDate = document.getElementById("initialDate").innerHTML;
            const initialDate = new Date(inputInitialDate);
            let inputInitialTime = document.getElementById("initialTime").innerHTML;
            const initialTime = new Date(parseInt(inputInitialTime) * 1000)
            var diffTime = Math.abs(nowDate - initialTime);
            var diffMinutes = Math.floor(diffTime / (60 * 1000));
            if (diffMinutes < 2) {
                t = "à l'instant"
            } else if (diffMinutes < 60) {
                t = "il y a " + diffMinutes + " minutes"
            } else {
                var diffHours = Math.floor(diffMinutes / 60);
                if (diffHours == 1) {
                    t = "il y a une heure"
                } else if (diffHours < 24) {
                    t = "il y a " + diffHours + " heures"
                } else {
                    var diffDays = Math.floor(diffHours / 24);
                    if (diffDays == 1) {
                        t = "hier"
                    } else {
                        t = "il y a " + diffDays + " jours"
                    }
                }
            }
            document.getElementById("dateDiffHere").innerHTML = t;
        }

        const nowDate = new Date();
        let today = nowDate.setHours(0, 0, 0, 0);

        function displayDate(then, date_string) {
            let diff = (then - today) / (1000 * 60 * 60 * 24)
            if (diff == 0) {
                const d = { 'de-CH': 'heute', 'en-GB': 'today', 'fr-CH': "aujourd'hui" }
                return d[locale]
            } else if (diff == 1) {
                const d = { 'de-CH': 'morgen', 'en-GB': 'tomorrow', 'fr-CH': 'demain' }
                return d[locale]
            } else if (diff < 7) {
                let d = { 'de-CH': `in ${diff} Tage`, 'en-GB': `in ${diff} days`, 'fr-CH': `dans ${diff} jours` }
                return d[locale]
            } else {
                return date_string;
            }
        }

        function injectTable(events, locale) {
            let t = ''
            events.sort(function (a, b) { return a.date - b.date });
            for (let x in events) {
                let event = events[x]
                workshopSuffix = ""
                if (event.organizer == "OPF WWF") {
                    workshopSuffix = "<br><span class='w3-animate-fading' id='Organized_WWF_OPF'>Organized by <b>One Planet Friends</b></span>"
                }
                if ((event.organizer == "FZC SEV52") || (event.place.indexOf("Espace de coworking Sev52") != -1)) {
                    workshopSuffix = "<br><span class='w3-animate-fading' id='Organized_FZC_SEV52'>Organisé par <b>Fresques Zamies & Co</b></span>"
                }
                t += '<tr class="WorkflowRow" onclick="navigate(this, \'' + event.url + '\')">'
                t += '<td>' + event.title + ' <img src="./flags/icons8-' + event.language + '-16.png" alt="' + event.language + '">' + workshopSuffix + '</td>'
                let then = new Date(event.date * 1000)
                t += '<td class="EventLongDate">' + displayDate(then, then.toLocaleString(locale, { "dateStyle": "full" })) + '</td>'
                t += '<td class="EventShortDate removed">' + then.toLocaleString(locale, { "dateStyle": "short" }) + '</td>'
                t += '<td class="eventLocation">' + event.city + '<span class="EventLocationDetails hidden"><br>' + event.place + '</span></td>'
                t += '</tr>'
            }
            return t
        }

        function eventIsInTheFuture(event) {
            return (event.date * 1000) >= today;
        }

        function rebuildEventTable(region_set, locale) {
            document.getElementById("event_container").innerHTML = ''
            const lregions = new Set();
            events = events.filter(eventIsInTheFuture)
            for (let x in events) {
                var event = events[x]
                if (region_set.has(event.lregion)) {
                    lregions.add(event.lregion)
                }
            }
            ar = Array.from(lregions)
            ar.sort()
            for (let lregion of ar.reverse()) {
                const filtered = events.filter(myFunction);
                function myFunction(event) {
                    return event.lregion == lregion || event.lregion == 'Both';
                }
                document.getElementById("event_container").innerHTML += injectTable(filtered, locale)
            }
        }
        function onLoad() {
            updateDateDiff()
            changeLanguage('fr', 'fr-CH', new Set(["Romandie"]))
        }
        function navigate(t, url) {
            t.style.cursor = 'wait';
            window.location = url;
        }
    </script>
</head>
<body onload="onLoad()">
    <table style="background-image: url('images/cotton.png');">
        <thead>
            <tr style="text-align:center;">
                <th style="cursor: pointer;">
                    <div><img id="Flag-de" class="LanguageFlag" onclick="changeLanguage('de', 'de-CH', new Set(['Sarine / Röstigraben', 'Deutschschweiz']))" src="flags/icons8-de-30.png" alt="de" /></div>
                    <div><img id="Flag-en" class="LanguageFlag" onclick="changeLanguage('en', 'en-GB', new Set(['Sarine / Röstigraben', 'Deutschschweiz']))" src="flags/icons8-en-30.png" alt="en" /></div>
                    <div><img id="Flag-fr" class="LanguageFlag Highlighted" onclick="changeLanguage('fr', 'fr-CH', new Set(['Sarine / Röstigraben', 'Romandie']))" src="flags/icons8-fr-30.png" alt="fr" /></div>
                </th>
                <th width=100% style="border: 1px gray; border-left-style: solid; font-family: var(--fontfam-headings); font-size: 40px; color: var(--accentcolor-2);" id="MainTitle">Ateliers zamis en Suisse</th>
                <th style="border: 1px gray; border-left-style: solid"><a href="about.html" id="AboutText">Qui sommes-nous</a></th>
            </tr>
        </thead>
    </table>

    <section class="cont-column">
        <div class="titleCont">
            <p id="MainParagraph">Cette page répertorie les ateliers en présentiel en Suisse prévus prochainement. En France, essayez <a href="https://trouverunefresque.org">TrouverUneFresque</a>.</p>
        </div>
        <div class="tableCont">
            <table class="eventsTable">
                <thead><tr><th id="HeaderWorkshop">Atelier</th><th id="HeaderDate" class="EventLongDate">Date</th><th id="HeaderDate" class="EventShortDate removed">Date</th><th class="EventLocation" id="HeaderLocation">Lieu</th></tr></thead>
                <tbody id="event_container">
                    <tr><td>Please enable JavaScript to use this site.</td></tr>
                </tbody>
            </table>
        </div>
        <p id="BugReport">Pour toute question, suggestion ou bug (par exemple, un lien est cassé, ou un événement en Suisse dans un des calendriers n'est pas répertorié sur cette page), merci de contacter <a href="mailto:jeffrey@theshifters.ch" target="_blank">jeffrey@theshifters.ch</a>.</p>
        <p id="IconSource">Les icônes du <a target="_blank" href="https://icons8.com/icon/u5e279g2v-R8/france">drapeau de France</a> et autres pays sont mis à disposition par <a target="_blank" href="https://icons8.com">Icons8</a>.</p>
        <span style="display:none" id="initialDate">{{initialDate}}</span>
        <span style="display:none" id="initialTime">{{initialTime}}</span>
        <p id="LastUpdate">Dernière mise à jour: <span id="dateDiffHere">il y a un certain temps</span>.</p>
    </section>
</body>
</html>
