<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico">
    <title>Fresques Zamies & Co</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Hanken+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --accentcolor-1: #7ea656;
            --accentcolor-2: #820001;
            --accentcolor-1-light: #cedebf;
            --accentcolor-2-light: #e4c5c5;
            --fontfam-headings: "Hanken Grotesk", Arial, sans-serif;
            --fontfam-text: "Montserrat", Arial, sans-serif;
        }

        .cornerimg {
            position: fixed;
            top: 0;
            right: 0;
            width: min(45px, 20%);
            z-index: -1;
        }

        h1, h2 {
            font-family: var(--fontfam-headings);
        }

        h1 {
            font-size: 40px;
        }

        h2 {
            font-size: 30px;
        }

        p {
            font-family: var(--fontfam-headings);
            color: #323331;
            font-size: 18px;
        }

        a {
            color: var(--accentcolor-2);
            transition: .2s ease;
        }

            a:hover {
                color: #53cb8f;
            }

        #.titleCont {
            #margin: 250px 0 100px;
            #
        }

        .titleCont h1 {
            background-image: url('images/cotton.png');
            font-size: 40px;
        }

        .slogan {
            font-size: 22px;
        }

        .cont-column {
            width: min(100%, 1000px);
            margin: auto;
        }

        .tableCont {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .eventsTable {
            border-collapse: collapse;
            width: 100%;
            background-image: url('images/cotton.png');
        }

        .eventsTable thead {
            background-image: url('images/brownpaper.png');
            font-weight: bold;
        }
        .eventsTable th {
            padding: 8px;
            font-family: var(--fontfam-text);
        }
        .eventsTable td {
            padding: 8px;
            font-family: var(--fontfam-text);
        }

        .eventsTable tr {
            transition: .3s ease;
        }

        .eventsTable tr:nth-child(even) {
            background-color: #d5e8f0;
        }

        .hidden {
            visibility: hidden;
        }

        .eventsTable tbody tr:hover {
            background-color: #53cb8f;
        }
        .eventsTable tr:hover span {
            visibility: visible;
        }

        .impactCont {
            width: 20%;
            margin: 50px auto;
            text-align: center;
        }

        .impactCont img {
            width: 100%;
        }
    </style>

    <script>
        const languageStrings = {{languageStrings}}
        function changeLanguage(lang, region_set) {
            for (let i in languageStrings) {
                let d = languageStrings.at(i)
                document.getElementById(d.id).innerHTML = d[lang]
            }
            rebuildEventTable(region_set)
        }
        events = {{ eventsAsJSON }}
        function updateDateDiff() { 
            // NOTE: this code ignores time zones.
            let inputInitialDate = document.getElementById("initialDate").innerHTML;
            const initialDate = new Date(inputInitialDate);
            let inputInitialTime = document.getElementById("initialTime").innerHTML;
            const initialTime = new Date(parseInt(inputInitialTime) * 1000)
            var diffTime = Math.abs(nowDate - initialTime);
            var diffMinutes = Math.floor(diffTime / (60 * 1000));
            if (diffMinutes < 2) {
                t = "à l'instant"
            } else if (diffMinutes < 60) {
                t = "il y a " + diffMinutes + " minutes"
            } else {
                var diffHours = Math.floor(diffMinutes / 60);
                if (diffHours == 1) {
                    t = "il y a une heure"
                } else if (diffHours < 24) {
                    t = "il y a " + diffHours + " heures"
                } else {
                    var diffDays = Math.floor(diffHours / 24);
                    if (diffDays == 1) {
                        t = "hier"
                    } else {
                        t = "il y a " + diffDays + " jours"
                    }
                }
            }
            document.getElementById("dateDiffHere").innerHTML = t;
        }

        const nowDate = new Date();
        let today = nowDate.setHours(0, 0, 0, 0);

        function displayDate(timestamp_sec, date_string) {
            let then = new Date(timestamp_sec * 1000)
            let diff = (then - today) / (1000 * 60 * 60 * 24)
            if (diff == 0) {
                return "aujourd'hui"
            } else if (diff == 1) {
                return 'demain'
            } else if (diff < 7) {
                return 'dans ' + Math.round(diff) + ' jours'
            } else {
                return date_string
            }
        }

        function injectTable(events) {
            let t = ''
            events.sort(function (a, b) { return a.date - b.date });
            for (let x in events) {
                var event = events[x]
                t += '<tr>'
                t += '<td>' + event.title + ' <img src="./flags/icons8-' + event.language + '-16.png" alt="' + event.language + '"></td>'
                t += '<td>' + displayDate(event.date, event.date_string) + '</td>'
                t += '<td>' + event.city + '<br><span class="hidden">' + event.place + '</span></td>'
                t += '<td><a href="' + event.url + '">Billeterie</a></td>'
                t += '</tr>'
            }
            return t
        }

        function eventIsInTheFuture(event) {
            return (event.date * 1000) >= today;
        }

        function rebuildEventTable(region_set) {
            document.getElementById("event_container").innerHTML = ''
            const lregions = new Set();
            events = events.filter(eventIsInTheFuture)
            for (let x in events) {
                var event = events[x]
                if (region_set.has(event.lregion)) {
                    lregions.add(event.lregion)
                }
            }
            ar = Array.from(lregions)
            ar.sort()
            for (let lregion of ar.reverse()) {
                const filtered = events.filter(myFunction);
                function myFunction(event) {
                    return event.lregion == lregion || event.lregion == 'Both';
                }
                document.getElementById("event_container").innerHTML += injectTable(filtered)
            }
        }
        function onLoad() {
            updateDateDiff()
            changeLanguage('fr', new Set(["Romandie"]))
        }
    </script>
</head>
<body onload="onLoad()">
    <table style="background-image: url('images/cotton.png');">
        <thead>
            <tr>
                <th style="border: 1px gray; border-right-style: solid;">
                    Deutschschweiz<br />
                    <img onclick="changeLanguage('de', new Set(['Sarine / Röstigraben', 'Deutschschweiz']))" src="flags/icons8-de-16.png" alt="de" />
                    <img onclick="changeLanguage('en', new Set(['Sarine / Röstigraben', 'Deutschschweiz']))" src="flags/icons8-en-16.png" alt="en" />
                </th>
                <th style="border: 1px gray; border-right-style: solid;" onclick="changeLanguage('fr', new Set(['Romandie']))">Romandie<br /><img src="flags/icons8-fr-16.png" alt="fr" /></th>
                <th width="100%" style="font-family: var(--fontfam-headings); font-size: 40px; color: var(--accentcolor-2);" id="MainTitle">Ateliers zamis en Suisse</th>
                <th style="border: 1px gray; border-left-style: solid; "><a href="about.html" id="AboutText">Qui sommes-nous</a></th>
            </tr>
        </thead>
    </table>
    <section class="cont-column">
        <div class="titleCont">
            <p id="MainParagraph">Cette page répertorie les ateliers en présentiel en Suisse prévus prochainement. En France, essayez <a href="https://trouverunefresque.org">TrouverUneFresque</a>.</p>
        </div>
        <div class="tableCont">
            <table class="eventsTable">
                <thead><tr><th id="HeaderWorkshop">Atelier</th><th id="HeaderDate">Date</th><th id="HeaderLocation">Lieu</th><th id="HeaderLink">Lien</th></tr></thead>
                <tbody id="event_container">
                    <tr><td>Please enable JavaScript to use this site.</td></tr>
                </tbody>
            </table>
        </div>
        <p id="BugReport">Pour toute question, suggestion ou bug (par exemple, un lien est cassé, ou un événement en Suisse dans un des calendriers n'est pas répertorié sur cette page), merci de contacter <a href="mailto:jeffrey@theshifters.ch" target="_blank">jeffrey@theshifters.ch</a>.</p>
        <p id="IconSource">Les icônes du <a target="_blank" href="https://icons8.com/icon/u5e279g2v-R8/france">drapeau de France</a> et autres pays sont mis à disposition par <a target="_blank" href="https://icons8.com">Icons8</a>.</p>
        <span style="display:none" id="initialDate">{{initialDate}}</span>
        <span style="display:none" id="initialTime">{{initialTime}}</span>
        <p id="LastUpdate">Dernière mise à jour: <span id="dateDiffHere">il y a un certain temps</span>.</p>
    </section>
</body>
</html>
